{{extend 'layout.html'}}

<h1>This is the order/new.html template</h1>

<form class="pure-form pure-form-stacked" action="{{=URL('save')}}" method="POST">
     <fieldset>
        <legend>Customer</legend>
            <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="customer-name">Customer Name</label>
                <input id="customer-name" name="customer-name" type="text" required>
            </div>

            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="recipient-name">Recipient Name</label>
                <input id="recipient-name" name="recipient-name" type="text" required>
            </div>
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="comment">Comment</label>
                <input id="comment" name="comment" type="text">
            </div>
        </div>
    </fieldset>
    <fieldset>
        <legend>Product</legend>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="item">Item#</label>
                <input id="item" name="item" type="text" required>
            </div>
        </div>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="quantity">Quantity</label>
                <input id="quantity" name="quantity" type="number" value="1" required>
            </div>
        </div>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="gifts-info">Gifts Infromation</label>
                <input id="gifts-info" name="gifts-info" type="text">
            </div>
        </div>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="rrp">RRP</label>
                <input id="rrp" name="rrp" type="number" step="0.01" requird > USD
            </div>
        </div>
        <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="ship-rate">Shipping Rate</label>
                <input id="ship-rate" name="ship-rate" type="number" step="0.01" required> USD
            </div>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="sold-price">Sold Price</label>
                <input id="sold-price" name="sold-price" type="number" step="0.01" required> CNY
            </div>
        </div>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="cost">Total Cost</label>
                <input id="cost" type="text" readonly> USD
            </div>
        </div>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="earning">Earning</label>
                <input id="earning" type="text" readonly> USD
            </div>
        </div>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="earning-cost">Earning / Total Cost </label>
                <input id="earning-cost" type="text" readonly> %
            </div>
        </div>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="points">Reward Points </label>
                <input id="points" type="text" readonly> USD
            </div>
        </div>
        <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="tax-rate">Tax Rate</label>
                <input id="tax-rate" name="tax-rate" type="number" step="0.01" requird> %
            </div>
        </div>

         <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="exchange-rate">Exchange Rate</label>
                <input id="exchange-rate" name="exchange-rate" type="number" step="0.01" required>
                USD = {{=exchangeRate}} CNY Exchange Rate Pulled {{=exchangeRatePulledDate}}
            </div>
        </div>
         <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="item">Reward Points</label>
                 <select id="reward" name="reward"><option></option></select>
            </div>
        </div>
   </fieldset>
    <fieldset>
        <legend>Shipment</legend>
            <div class="pure-g">
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="ship-date">Ship Date</label>
                <input id="ship-date" name="ship-date" type="date" required>
            </div>

            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="ship-company">Company</label>
                <input id="ship-company" name="ship-company" type="text" required>
            </div>
            <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <label for="tracking">Tracking</label>
                <input id="tracking" name="tracking" type="text" required>
            </div>
                <label for="tracking">Destination</label>
                <div class="pure-u-1-1 pure-u-md-1-3 pure-u-lg-1-3">
                <select id="destination" name="destination"><option></option></select>
                </div>
    </fieldset>

    <button type="submit" class="pure-button">Save Order</button>
    </fieldset>
</form>


<script>
function calculateTotalCost(){
        var quantity = Number($('#quantity').val());
        var cost =(Number($('#rrp').val()) * (1 + Number($('#tax-rate').val())/100.0) + Number($('#ship-rate').val()));
        cost = Math.round(cost * 100) / 100;
        cost = cost ;
        exchangeRate = Number($('#exchange-rate').val());
        earning = Number($('#sold-price').val()) / exchangeRate - cost ;
        earning = Math.round(earning * 100) / 100;
        earning = earning;
        percentage = Math.round((earning / cost) * 100);
        points = Math.round($( "#reward option:selected" ).val() * Number($('#rrp').val()) * 100) / 100;
        points = points
        $("#cost").val(cost*quantity);
        $("#earning").val(earning*quantity);
        $("#earning-cost").val(percentage);
        $("#points").val(points*quantity);
    }

$( document ).ready(function() {

   var options = ['北京', '上海', '广东', '江苏', '重庆','四川','陕西','山东',  '天津','江西','浙江',
                       '安徽', '河南', '山西','河北', '香港',  '湖南',
                       '福建', '云南', '广西', '海南',  '湖北',  '辽宁',
                       '台湾', '黑龙江', '内蒙古', '澳门', '贵州', '甘肃', '青海', '新疆', '西藏', '吉林', '宁夏'];

   /* Remove all options from the select list */
    var select = document.getElementById("destination");
    for(var i = 0; i < options.length; i++) {
        var opt = options[i];
        var el = document.createElement("option");
        el.textContent = opt;
        el.value = opt;
        select.appendChild(el);
    }

    var select2 = document.getElementById("reward");
    {{for r in rewardOptions:}}
        var opt = '{{=r.name}}';
        var el = document.createElement("option");
        el.textContent = opt;
        el.value = '{{=r.ratio}}';
        select2.appendChild(el);
    {{pass}}

    $('#reward')[0].selectedIndex = 1;

    $('#tax-rate').val("9");

    $('#exchange-rate').val("{{= exchangeRate}}");

    $('#rrp').keyup(function() {
       calculateTotalCost();
    });

    $('#ship-rate').keyup(function() {
       calculateTotalCost();
    });

    $('#sold-price').keyup(function() {
       calculateTotalCost();
    });

    $('#tax-rate').keyup(function() {
       calculateTotalCost();
    });

    $('#exchange-rate').keyup(function() {
       calculateTotalCost();
    });

    $('#reward').change(function() {
       calculateTotalCost();
    });

    $('#quantity').change(function() {
       calculateTotalCost();
    });


});

</script>
